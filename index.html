<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Network Checker</title>
<style>
body { font-family: 'Segoe UI', Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; }
.container { background-color: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
h1 { color: #2c3e50; text-align: center; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
.network-table { width: 100%; border-collapse: collapse; margin-top: 20px; background-color: #f8f9fa; border-radius: 4px; overflow: hidden; }
.network-table th, .network-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #dee2e6; }
.network-table th { background-color: #e9ecef; font-weight: 600; color: #495057; width: 40%; }
.network-table tr:last-child td { border-bottom: none; }
.loading { text-align: center; color: #666; font-style: italic; padding: 20px; }
.error { color: #dc3545; background-color: #ffe6e6; border: 1px solid #dc3545; padding: 10px; border-radius: 4px; margin-top: 10px; }
.refresh-button { display: block; margin: 20px auto 0; padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
.refresh-button:hover { background-color: #2980b9; }
.header { font-size: 18px; font-weight: 600; margin-top: 20px; color: #2c3e50; border-bottom: 1px solid #3498db; padding-bottom: 5px; }
</style>
</head>
<body>

<div class="container">
<h1>Network Checker</h1>
<div id="output" class="loading">Klik tombol di bawah untuk deteksi IP...</div>
<button class="refresh-button" onclick="detectNetwork()">Deteksi Sekarang</button>
</div>

<script>
async function detectNetwork() {
    const output = document.getElementById('output');
    output.className = 'loading';
    output.textContent = 'Mendeteksi IP...';

    // --- IP Privat via WebRTC ---
    const RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection;
    if (!RTCPeerConnection) {
        output.className = 'error';
        output.textContent = 'Browser tidak mendukung WebRTC.';
        return;
    }

    const ips = new Set();
    let mdnsObserved = false;
    const pc = new RTCPeerConnection({iceServers:[]});
    pc.createDataChannel("test");
    pc.onicecandidate = (event) => {
        if (!event.candidate) return;
        const cand = event.candidate.candidate;
        if (cand.includes(".local")) mdnsObserved = true;
        const match = cand.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);
        if (match) {
            const ip = match[1];
            if (ip !== "127.0.0.1") ips.add(ip);
        }
    };
    await pc.setLocalDescription(await pc.createOffer());
    await new Promise(r => setTimeout(r, 10));
    pc.close();

    const privateIPs = Array.from(ips);
    let subnetMask = "255.255.255.0", defaultGateway = null, networkId = null;
    if (privateIPs.length > 0) {
        const ip = privateIPs[0];
        const parts = ip.split(".").map(Number);

        // Tentukan subnet mask berdasarkan range private IP
        if (parts[0] === 10) subnetMask = "255.0.0.0";
        else if (parts[0] === 172 && parts[1] >= 16 && parts[1] <= 31) subnetMask = "255.240.0.0";
        else if (parts[0] === 192 && parts[1] === 168) subnetMask = "255.255.255.0";

        networkId = `${parts[0]}.${parts[1]}.${parts[2]}`;
        defaultGateway = `${parts[0]}.${parts[1]}.${parts[2]}.1`;
    }

    // --- IP Publik via fetch (fallback ke 2 layanan) ---
    async function getPublicIP() {
        try {
            const res = await fetch('https://api.ipify.org?format=json');
            const data = await res.json();
            if (data.ip) return data.ip;
        } catch {}
        try {
            const res2 = await fetch('https://ipinfo.io/json?token=7de3e574f56ab3'); // token opsional
            const data2 = await res2.json();
            if (data2.ip) return data2.ip;
        } catch {}
        return "Tidak dapat dideteksi";
    }

    const publicIP = await getPublicIP();

    // --- Render Tabel ---
    output.className = '';
    output.textContent = '';

    // IP Privat
    const privateDiv = document.createElement('div');
    privateDiv.className = "header";
    privateDiv.textContent = "Informasi IP Privat";
    output.appendChild(privateDiv);

    const privateTable = document.createElement('table');
    privateTable.className = "network-table";
    if (privateIPs.length > 0) privateTable.insertRow().innerHTML = `<th>Private IP(s)</th><td>${privateIPs.join(", ")}</td>`;
    if (subnetMask) privateTable.insertRow().innerHTML = `<th>Subnet Mask</th><td>${subnetMask}</td>`;
    if (defaultGateway) privateTable.insertRow().innerHTML = `<th>Default Gateway</th><td>${defaultGateway}</td>`;
    if (networkId) privateTable.insertRow().innerHTML = `<th>Network ID</th><td>${networkId}</td>`;
    if (mdnsObserved) privateTable.insertRow().innerHTML = `<th>Status</th><td>Browser menyamarkan IP lokal (mDNS)</td>`;
    output.appendChild(privateTable);

    // IP Publik
    const publicDiv = document.createElement('div');
    publicDiv.className = "header";
    publicDiv.textContent = "Informasi IP Publik";
    output.appendChild(publicDiv);

    const publicTable = document.createElement('table');
    publicTable.className = "network-table";
    publicTable.insertRow().innerHTML = `<th>Public IP</th><td>${publicIP}</td>`;
    output.appendChild(publicTable);
}
</script>

</body>
</html>
